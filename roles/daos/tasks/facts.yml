---
# custom facts for the daos role

- name: daos | Create facts directory
  ansible.builtin.file:
    path: '/etc/ansible/facts.d'
    state: directory
    owner: root
    group: root
    mode: '0755'

- name: daos | Stat /etc/ansible/facts.d/daos.fact
  ansible.builtin.stat:
    path: /etc/ansible/facts.d/daos.fact
  register: daos_fact

- name: daos | Copy daos facts script
  ansible.builtin.template:
    src: 'etc/ansible/facts.d/daos.fact.j2'
    dest: '/etc/ansible/facts.d/daos.fact'
    owner: root
    group: root
    mode: '0755'
  register: daos_fact_script

- name: daos | Reload facts
  ansible.builtin.setup:
    filter: ansible_local
  when: daos_fact_script.changed  # noqa no-handler
